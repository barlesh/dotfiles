#!/usr/bin/env bash
# Pre-commit hook: sync live configs into the repo before committing.
# Installed to .git/hooks/pre-commit by bootstrap.sh.

DOTFILES_DIR="${HOME}/dotfiles"
SAVE_SCRIPT="${DOTFILES_DIR}/bin/dotfiles-save.sh"

if [[ -x "${SAVE_SCRIPT}" ]]; then
  "${SAVE_SCRIPT}"

  # Stage any config files that changed
  for dir in claude iterm2 zsh; do
    git -C "${DOTFILES_DIR}" add -N "${dir}/" 2>/dev/null || true
    if ! git -C "${DOTFILES_DIR}" diff --quiet -- "${dir}/"; then
      git -C "${DOTFILES_DIR}" add "${dir}/"
      echo "==> Pre-commit: staged updated ${dir} configs"
    fi
  done
fi
